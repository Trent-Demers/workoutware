<!--
    Template: Manage Goals (Advanced Goal Tracking)

    Purpose:
    - Allow users to create new exercise-specific fitness goals.
    - Display active goals with progress bars and time remaining.
    - Display recently completed goals.
    - Provide quick navigation to dashboard, progress tracking, and workout logging.

    Context variables expected:
    - exercises:
        List of Exercise objects used to select which exercise a goal relates to.

    - active_goals:
        Queryset of user Goal objects where status = "active".
        Each goal has:
            ‚Ä¢ exercise_id (FK to Exercise)
            ‚Ä¢ goal_type (string: 'max_weight', 'total_volume', 'workout_count')
            ‚Ä¢ target_value (numeric)
            ‚Ä¢ current_value (numeric or None)
            ‚Ä¢ target_date (date)
            ‚Ä¢ other internal attributes (status, timestamps)

    - completed_goals:
        List of goals marked completed recently.

    Template features:
    1. **Goal Creation Form**
       - User chooses an exercise, goal type, numeric target, and target date.
       - Posts to the current view using POST.

    2. **Active Goals Section**
       - Shows a goal card for each active goal.
       - Progress bar uses custom template filters:
            ‚Ä¢ goal.current_value|div:goal.target_value|mul:100
         (These filters must be defined in your Django project.)
       - Shows days remaining using Django's `timeuntil` filter.

    3. **Completed Goals Section**
       - Shows a summary card for recently completed goals.

    4. **Navigation**
       - Back to Dashboard
       - View Progress
       - Log Workout

    Notes:
    - No personal user information is shown; only goal-specific data.
    - Progress bar width auto-adjusts using inline style percentages.
    - Uses CSS grid to arrange goal cards responsively.
-->
<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="/static/stylesheets/workoutware.css">
    <title>Manage Goals</title>
    <style>
        .goals-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .goal-form {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 12px;
            color: white;
            margin-bottom: 40px;
        }
        .goal-form input, .goal-form select {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: none;
            border-radius: 6px;
            font-size: 1em;
        }
        .goal-form button {
            background: white;
            color: #667eea;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        .goals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .goal-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-left: 6px solid #4caf50;
        }
        .goal-card.completed {
            border-left-color: #2196f3;
            opacity: 0.8;
        }
        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .goal-progress {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }
        .goal-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 0.3s;
        }
        .nav-buttons {
            margin: 20px 0;
        }
        .nav-buttons a {
            display: inline-block;
            padding: 10px 20px;
            background: #2196f3;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="goals-container">
        <h1>üéØ Fitness Goals</h1>
        
        <div class="nav-buttons">
            <a href="{% url 'home' %}">‚Üê Dashboard</a>
            <a href="{% url 'progress' %}">üìä Progress</a>
            <a href="{% url 'log_workout' %}">üí™ Log Workout</a>
        </div>
        
        <div class="goal-form">
            <h2>Set New Goal</h2>
            <form method="post">
                {% csrf_token %}
                
                <label>Exercise:</label>
                <select name="exercise_id" required>
                    <option value="">-- Choose Exercise --</option>
                    {% for ex in exercises %}
                        <option value="{{ ex.exercise_id }}">{{ ex.name }}</option>
                    {% endfor %}
                </select>
                
                <label>Goal Type:</label>
                <select name="goal_type" required>
                    <option value="max_weight">Max Weight PR</option>
                    <option value="total_volume">Total Volume</option>
                    <option value="workout_count">Number of Workouts</option>
                </select>
                
                <label>Target Value:</label>
                <input type="number" name="target_value" step="0.1" placeholder="e.g., 225 lbs" required>
                
                <label>Target Date:</label>
                <input type="date" name="target_date" required>
                
                <button type="submit">Create Goal</button>
            </form>
        </div>
        
        <h2>Active Goals ({{ active_goals.count }})</h2>
        <div class="goals-grid">
            {% for goal in active_goals %}
            <div class="goal-card">
                <div class="goal-header">
                    <h3>{{ goal.exercise_id.name }}</h3>
                    <span style="font-size: 1.5em;">üéØ</span>
                </div>
                
                <p><strong>Type:</strong> {{ goal.goal_type|upper }}</p>
                <p><strong>Target:</strong> {{ goal.target_value }} {% if goal.goal_type == 'max_weight' %}lbs{% endif %}</p>
                <p><strong>Deadline:</strong> {{ goal.target_date|date:"M d, Y" }}</p>
                
                {% if goal.current_value %}
                <div class="goal-progress">
                    <div class="goal-progress-bar" style="width: {{ goal.current_value|div:goal.target_value|mul:100 }}%;"></div>
                </div>
                <p style="text-align: center; color: #666;">
                    {{ goal.current_value }} / {{ goal.target_value }} 
                    ({{ goal.current_value|div:goal.target_value|mul:100|floatformat:0 }}%)
                </p>
                {% else %}
                <p style="color: #999; text-align: center;">Not started yet</p>
                {% endif %}
                
                <p style="font-size: 0.9em; color: #666;">
                    Days remaining: {{ goal.target_date|timeuntil }}
                </p>
            </div>
            {% empty %}
            <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #999;">
                <p style="font-size: 1.2em;">No active goals yet. Set one above to start tracking!</p>
            </div>
            {% endfor %}
        </div>
        
        {% if completed_goals %}
        <h2>Recently Completed Goals</h2>
        <div class="goals-grid">
            {% for goal in completed_goals %}
            <div class="goal-card completed">
                <div class="goal-header">
                    <h3>{{ goal.exercise_id.name }}</h3>
                    <span style="font-size: 1.5em;">‚úÖ</span>
                </div>
                <p><strong>Completed:</strong> {{ goal.target_date|date:"M d, Y" }}</p>
                <p><strong>Achievement:</strong> {{ goal.target_value }} {% if goal.goal_type == 'max_weight' %}lbs{% endif %}</p>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</body>
</html>
