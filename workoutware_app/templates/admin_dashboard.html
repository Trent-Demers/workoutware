{% load static %}
<!DOCTYPE html>
<html>
 <head>
  <link href="{% static 'stylesheets/workoutware.css' %}" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <title>
   Admin Dashboard
  </title>
  <style>
   .user-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
   }
   .btn-edit, .btn-delete {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    font-size: 0.85em;
    margin: 2px;
    transition: var(--transition-normal);
   }
   .btn-edit {
    background: rgba(116, 185, 255, 0.2);
    color: var(--info);
    border: 1px solid var(--info);
   }
   .btn-edit:hover {
    background: var(--info);
    color: var(--bg-dark);
   }
   .btn-delete {
    background: rgba(255, 107, 107, 0.2);
    color: var(--danger);
    border: 1px solid var(--danger);
   }
   .btn-delete:hover {
    background: var(--danger);
    color: white;
   }
   .edit-form {
    display: none;
    padding: 20px;
    background: var(--bg-elevated);
    border-radius: 10px;
    margin-top: 10px;
   }
   .action-buttons {
    display: flex;
    gap: 5px;
   }
  </style>
 </head>
 <body>
  <div class="container-wrapper">
   <div class="dashboard-header fade-in">
   <div>
    <h1>
     <i class="fas fa-cog"></i> Admin Dashboard
    </h1>
    <p>
     System Management &amp; Oversight
    </p>
   </div>
   <form action="{% url 'logout' %}" method="post">
    {% csrf_token %}
    <button class="logout-btn" type="submit">
     <i class="fas fa-sign-out-alt"></i> Log Out
    </button>
   </form>
  </div>
  <div class="admin-stats">
   <div class="admin-stat-card fade-in fade-in-delay-1">
    <div class="stat-icon">
     <i class="fas fa-users"></i>
    </div>
    <div class="stat-number">
     {{ total_users }}
    </div>
    <div class="stat-label">
     Total Users
    </div>
   </div>
   <div class="admin-stat-card fade-in fade-in-delay-2">
    <div class="stat-icon">
     <i class="fas fa-dumbbell"></i>
    </div>
    <div class="stat-number">
     {{ total_exercises }}
    </div>
    <div class="stat-label">
     Exercise Library
    </div>
   </div>
   <div class="admin-stat-card fade-in fade-in-delay-3">
    <div class="stat-icon">
     <i class="fas fa-clipboard-list"></i>
    </div>
    <div class="stat-number">
     {{ total_workouts }}
    </div>
    <div class="stat-label">
     Total Workouts Logged
    </div>
   </div>
   <div class="admin-stat-card fade-in fade-in-delay-4">
    <div class="stat-icon">
     <i class="fas fa-bolt"></i>
    </div>
    <div class="stat-number">
     {{ active_today }}
    </div>
    <div class="stat-label">
     Active Today
    </div>
   </div>
  </div>
  <div class="admin-section fade-in">
   <h2>
    <i class="fas fa-user-group"></i> Recent Users
   </h2>
   {% if recent_users %}
   <div class="user-list">
    {% for user in recent_users %}
    <div class="goal-item">
     <strong>
      <i class="fas fa-user"></i> {{ user.first_name }} {{ user.last_name }}
     </strong>
     <br/>
     <small style="color: var(--text-muted);">
      <i class="fas fa-envelope"></i> {{ user.email }}
     </small>
     <br/>
     <small style="color: var(--text-muted);">
      <i class="far fa-calendar"></i> Registered: {{ user.date_registered|date:"M d, Y" }}
     </small>
     <br/>
     <small style="color: var(--text-muted);">
      <i class="fas fa-bullseye"></i> Goal: {{ user.fitness_goal|default:"Not set" }}
     </small>
    </div>
    {% endfor %}
   </div>
   {% else %}
   <div class="empty-state">
    <i class="fas fa-users"></i>
    <p>No users registered yet.</p>
   </div>
   {% endif %}
  </div>
  <div class="admin-section fade-in">
   <h2>
    <i class="fas fa-dumbbell"></i> Exercise Library Management
   </h2>
   <p>
    <strong>
     Total Exercises:
    </strong>
    {{ total_exercises }}
   </p>
   <h3>
    <i class="fas fa-plus-circle"></i> Add New Exercise
   </h3>
   <form action="{% url 'add_exercise' %}" method="post">
    {% csrf_token %}
    <div class="form-container">
     <label for="exercise_name">
      <i class="fas fa-tag"></i> Exercise Name
     </label>
     <input id="exercise_name" name="exercise_name" required="" type="text" value=""/>
     <label for="exercise_type">
      <i class="fas fa-layer-group"></i> Exercise Type
     </label>
     <select id="exercise_type" name="exercise_type" required="">
      <option value="strength">
       Strength
      </option>
      <option value="cardio">
       Cardio
      </option>
      <option value="flexibility">
       Flexibility
      </option>
     </select>
     <label for="exercise_subtype">
      <i class="fas fa-tags"></i> Exercise Subtype
     </label>
     <select id="exercise_subtype" name="exercise_subtype">
      <option value="compound">
       Compound
      </option>
      <option value="isolation">
       Isolation
      </option>
      <option value="steady_state">
       Steady State
      </option>
      <option value="isometric">
       Isometric
      </option>
     </select>
     <label for="exercise_equipment">
      <i class="fas fa-wrench"></i> Exercise Equipment
     </label>
     <select id="exercise_equipment" name="exercise_equipment">
      <option value="body_weight">
       Body Weight
      </option>
      <option value="barbell">
       Barbell
      </option>
      <option value="dumbbell">
       Dumbbell
      </option>
      <option value="machine">
       Machine
      </option>
      <option value="cable">
       Cable
      </option>
     </select>
     <label for="exercise_difficulty">
      <i class="fas fa-signal"></i> Exercise Difficulty (1-5)
     </label>
     <input id="exercise_difficulty" max="5" min="1" name="exercise_difficulty" required="" step="1" type="number" value="3"/>
     <label for="exercise_description">
      <i class="fas fa-align-left"></i> Exercise Description
     </label>
     <textarea cols="40" id="exercise_description" name="exercise_description" placeholder="How to perform this exercise..." rows="5"></textarea>
     <label for="exercise_demo">
      <i class="fas fa-video"></i> Exercise Demo Link
     </label>
     <input id="exercise_demo" name="exercise_demo" placeholder="https://youtube.com/..." type="text" value=""/>
     <button type="submit">
      <i class="fas fa-plus"></i> Add Exercise
     </button>
    </div>
   </form>
   <h3 style="margin-top: 30px;">
    <i class="fas fa-list"></i> Current Exercises in Library
   </h3>
   {% if exercises %}
   <table class="exercise-table">
    <thead>
     <tr>
      <th>
       <i class="fas fa-hashtag"></i> ID
      </th>
      <th>
       <i class="fas fa-tag"></i> Name
      </th>
      <th>
       <i class="fas fa-layer-group"></i> Type
      </th>
      <th>
       <i class="fas fa-tags"></i> Subtype
      </th>
      <th>
       <i class="fas fa-wrench"></i> Equipment
      </th>
      <th>
       <i class="fas fa-signal"></i> Difficulty
      </th>
      <th>
       <i class="fas fa-cogs"></i> Actions
      </th>
     </tr>
    </thead>
    <tbody>
     {% for ex in exercises %}
     <tr>
      <td>
       {{ ex.exercise_id }}
      </td>
      <td>
       <strong>
        {{ ex.name }}
       </strong>
      </td>
      <td>
       {{ ex.type|capfirst }}
      </td>
      <td>
       {{ ex.subtype|default:"--" }}
      </td>
      <td>
       {{ ex.equipment|default:"--" }}
      </td>
      <td>
       {{ ex.difficulty }}/5
      </td>
      <td>
       <div class="action-buttons">
        <button class="btn-edit" onclick="toggleEdit({{ ex.exercise_id }})">
         <i class="fas fa-edit"></i> Edit
        </button>
        <form action="{% url 'delete_exercise' ex.exercise_id %}" method="post" onsubmit="return confirm('Are you sure you want to delete this exercise?');" style="display: inline;">
         {% csrf_token %}
         <button class="btn-delete" type="submit">
          <i class="fas fa-trash"></i> Delete
         </button>
        </form>
       </div>
      </td>
     </tr>
     <tr>
      <td colspan="7">
       <div class="edit-form" id="edit-form-{{ ex.exercise_id }}">
        <h4>
         <i class="fas fa-edit"></i> Edit: {{ ex.name }}
        </h4>
        <form action="{% url 'edit_exercise' ex.exercise_id %}" method="post">
         {% csrf_token %}
         <label>
          <i class="fas fa-tag"></i> Name
         </label>
         <input name="exercise_name" required="" type="text" value="{{ ex.name }}"/>
         <label>
          <i class="fas fa-layer-group"></i> Type
         </label>
         <select name="exercise_type">
          <option value="strength" {% if ex.type == 'strength' %}selected{% endif %}>
           Strength
          </option>
          <option value="cardio" {% if ex.type == 'cardio' %}selected{% endif %}>
           Cardio
          </option>
          <option value="flexibility" {% if ex.type == 'flexibility' %}selected{% endif %}>
           Flexibility
          </option>
         </select>
         <label>
          <i class="fas fa-tags"></i> Subtype
         </label>
         <input name="exercise_subtype" type="text" value="{{ ex.subtype }}"/>
         <label>
          <i class="fas fa-wrench"></i> Equipment
         </label>
         <input name="exercise_equipment" type="text" value="{{ ex.equipment }}"/>
         <label>
          <i class="fas fa-signal"></i> Difficulty (1-5)
         </label>
         <input max="5" min="1" name="exercise_difficulty" type="number" value="{{ ex.difficulty }}"/>
         <label>
          <i class="fas fa-align-left"></i> Description
         </label>
         <textarea name="exercise_description" rows="3">{{ ex.description }}</textarea>
         <label>
          <i class="fas fa-video"></i> Demo Link
         </label>
         <input name="exercise_demo" type="text" value="{{ ex.demo_link }}"/>
         <div style="margin-top: 15px;">
          <button type="submit">
           <i class="fas fa-save"></i> Save Changes
          </button>
          <button onclick="toggleEdit({{ ex.exercise_id }})" type="button" class="btn-secondary">
           <i class="fas fa-times"></i> Cancel
          </button>
         </div>
        </form>
       </div>
      </td>
     </tr>
     {% endfor %}
    </tbody>
   </table>
   {% else %}
   <div class="empty-state">
    <i class="fas fa-dumbbell"></i>
    <p>No exercises in library yet.</p>
   </div>
   {% endif %}
  </div>
  <div class="admin-section fade-in">
   <h2>
    <i class="fas fa-chart-bar"></i> System Analytics
   </h2>
   <p>
    <strong>
     <i class="fas fa-star"></i> Most Popular Exercises:
    </strong>
   </p>
   {% if popular_exercises %}
   <ul style="padding-left: 20px;">
    {% for ex in popular_exercises %}
    <li style="list-style: disc; margin-bottom: 8px; color: var(--text-secondary);">
     <strong>
      {{ ex.name }}
     </strong>
     - Used {{ ex.usage_count }} times
    </li>
    {% endfor %}
   </ul>
   {% else %}
   <div class="empty-state">
    <i class="fas fa-chart-pie"></i>
    <p>No workout data yet.</p>
   </div>
   {% endif %}
  </div>
  <script>
   function toggleEdit(exerciseId) {
            const editForm = document.getElementById('edit-form-' + exerciseId);
            if (editForm.style.display === 'none' || editForm.style.display === '') {
                editForm.style.display = 'block';
            } else {
                editForm.style.display = 'none';
            }
        }
  </script>
  </div>
 </body>
</html>
