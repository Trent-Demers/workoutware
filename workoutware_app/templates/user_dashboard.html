<!--
    Template: User Dashboard

    Purpose:
    --------
    - Main landing page for logged-in users.
    - Provides a quick overview of:
        • Current streak and workout counts
        • Navigation to key features (workouts, progress, goals, body stats)
        • Recent personal records (PRs)
        • Active goals with mini progress bars

    Expected Context Variables:
    ---------------------------
    user :
        Django User object; `user.username` is shown in the welcome header.

    streak_days : int
        Current consecutive-day workout streak.

    workouts_this_week : int
        Number of completed workouts in the current week.

    total_workouts : int
        Total number of completed workouts by this user.

    recent_prs : iterable of PR objects/dicts
        Each item should provide:
            • exercise_name
            • pb_weight
            • previous_pr (optional)
            • improvement (difference vs previous PR)
            • pb_date

    active_goals : iterable of Goal objects
        Each goal should provide:
            • goal_description
            • target_value
            • current_value (optional)
            • unit (e.g., lbs, reps, workouts, minutes)
            • target_date (optional)

    URL Dependencies (named URL patterns):
    --------------------------------------
    - 'logout'                 → POST log out
    - 'completed_workouts_week'→ list of workouts completed this week
    - 'completed_workouts'     → list of all completed workouts
    - 'log_workout'            → start/log a workout session
    - 'progress'               → analytics / progress dashboard
    - 'manage_goals'           → goal management page
    - 'log_body_stats'         → body metrics logging page

    Notes:
    ------
    - Cards and stat boxes are fully clickable only where wrapped in <a> tags.
    - Mini goal progress bar uses `{% widthratio %}` to compute `progress_percent`.
    - No JavaScript is required; all behavior is purely navigational and presentational.
-->
{% load static %}
<!DOCTYPE html>
<html>
 <head>
  <link href="{% static 'stylesheets/workoutware.css' %}" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <title>
   User Dashboard
  </title>
 </head>
 <body>
  <div class="container-wrapper">
   <div class="dashboard-header fade-in">
   <div>
    <h1>
     Welcome, {{ user.username }}!
    </h1>
    <p>
     Your Fitness Journey Starts Here
    </p>
   </div>
   <form action="{% url 'logout' %}" method="post">
    {% csrf_token %}
    <button class="logout-btn" type="submit">
     <i class="fas fa-sign-out-alt"></i> Log Out
    </button>
   </form>
  </div>
  <div class="stats-grid">
   <div class="stat-box fade-in fade-in-delay-1">
    <div class="stat-icon">
     <i class="fas fa-fire-flame-curved"></i>
    </div>
    <div class="stat-number">
     {{ streak_days }}
    </div>
    <div class="stat-label">
     Day Workout Streak
    </div>
   </div>
   <a href="{% url 'completed_workouts_week' %}" style="text-decoration: none; color: inherit;">
    <div class="stat-box stat-box-clickable fade-in fade-in-delay-2">
     <div class="stat-icon">
      <i class="fas fa-calendar-week"></i>
     </div>
     <div class="stat-number">
      {{ workouts_this_week }}
     </div>
     <div class="stat-label">
      Workouts This Week
     </div>
     <div style="font-size: 0.8em; color: var(--text-muted); margin-top: 5px;">
      View completed workouts this week <i class="fas fa-arrow-right"></i>
     </div>
    </div>
   </a>
   <a href="{% url 'completed_workouts' %}" style="text-decoration: none; color: inherit;">
    <div class="stat-box stat-box-clickable fade-in fade-in-delay-3">
     <div class="stat-icon">
      <i class="fas fa-dumbbell"></i>
     </div>
     <div class="stat-number">
      {{ total_workouts }}
     </div>
     <div class="stat-label">
      Total Workouts
     </div>
     <div style="font-size: 0.8em; color: var(--text-muted); margin-top: 5px;">
      View past completed workouts <i class="fas fa-arrow-right"></i>
     </div>
    </div>
   </a>
   <div class="stat-box fade-in fade-in-delay-4">
    <div class="stat-icon">
     <i class="fas fa-trophy"></i>
    </div>
    <div class="stat-number">
     {{ recent_prs|length }}
    </div>
    <div class="stat-label">
     Recent PRs
    </div>
   </div>
  </div>
  <div class="dashboard-cards">
   <a class="dashboard-card card-blue fade-in" href="{% url 'log_workout' %}">
    <div class="card-icon">
     <i class="fas fa-dumbbell"></i>
    </div>
    <div class="card-title">
     Log Workout
    </div>
    <div class="card-description">
     Start a new workout session and track your exercises
    </div>
   </a>
   <a class="dashboard-card card-green fade-in fade-in-delay-1" href="{% url 'progress' %}">
    <div class="card-icon">
     <i class="fas fa-chart-line"></i>
    </div>
    <div class="card-title">
     View Progress
    </div>
    <div class="card-description">
     See your trends, PRs, and validation history
    </div>
   </a>
   <a class="dashboard-card card-orange fade-in fade-in-delay-2" href="{% url 'manage_goals' %}">
    <div class="card-icon">
     <i class="fas fa-bullseye"></i>
    </div>
    <div class="card-title">
     Manage Goals
    </div>
    <div class="card-description">
     Set and track your fitness goals
    </div>
   </a>
   <a class="dashboard-card card-purple fade-in fade-in-delay-3" href="{% url 'log_body_stats' %}">
    <div class="card-icon">
     <i class="fas fa-ruler-combined"></i>
    </div>
    <div class="card-title">
     Log Body Stats
    </div>
    <div class="card-description">
     Track bodyweight and measurements
    </div>
   </a>
  </div>
  <div class="achievements-section fade-in">
   <h2>
    <i class="fas fa-medal"></i> Recent Personal Records
   </h2>
   {% if recent_prs %}
   <div class="pr-list">
    {% for pr in recent_prs %}
    <div class="pr-item">
     <strong>
      {{ pr.exercise_name }}
     </strong>
     <br/>
     <span style="font-size: 1.3em; color: var(--success);">
      {{ pr.pb_weight }} lbs
     </span>
     {% if pr.previous_pr %}
     <span style="color: var(--text-muted);">
      (+{{ pr.improvement|floatformat:1 }} lbs from {{ pr.previous_pr }} lbs)
     </span>
     {% endif %}
     <br/>
     <small style="color: var(--text-muted);">
      <i class="far fa-calendar"></i> {{ pr.pb_date|date:"M d, Y" }}
     </small>
    </div>
    {% endfor %}
   </div>
   {% else %}
   <div class="empty-state">
    <i class="fas fa-trophy"></i>
    <p>No PRs yet. Start logging workouts to track your progress!</p>
   </div>
   {% endif %}
  </div>
  <div class="achievements-section fade-in" style="margin-top: 20px;">
   <h2>
    <i class="fas fa-crosshairs"></i> Active Goals
   </h2>
   {% if active_goals %}
            {% for goal in active_goals %}
   <div class="goal-item">
    <strong>
     {{ goal.goal_description }}
    </strong>
    <br/>
    <span style="color: var(--text-muted);">
     <i class="fas fa-flag-checkered"></i> Target: {{ goal.target_value }} {{ goal.unit }}
    </span>
    {% if goal.target_date %} by {{ goal.target_date|date:"M d" }}{% endif %}
    <br/>
    {% if goal.current_value %}
    <div class="progress-mini">
     {% widthratio goal.current_value goal.target_value 100 as progress_percent %}
     <div class="progress-mini-fill" style="width: {% if progress_percent > 100 %}100{% else %}{{ progress_percent }}{% endif %}%;">
     </div>
    </div>
    <small>
     {{ goal.current_value }} / {{ goal.target_value }} {{ goal.unit }} ({{ progress_percent }}%)
    </small>
    {% else %}
    <small style="color: var(--text-muted);">
     <i class="fas fa-hourglass-start"></i> Not started yet
    </small>
    {% endif %}
   </div>
   {% endfor %}
        {% else %}
   <div class="empty-state">
    <i class="fas fa-bullseye"></i>
    <p>No active goals.</p>
    <a href="{% url 'manage_goals' %}" class="btn">
     <i class="fas fa-plus"></i> Set a Goal
    </a>
   </div>
   {% endif %}
  </div>
  </div>
 </body>
</html>
