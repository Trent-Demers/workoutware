{% load static %}
<!DOCTYPE html>
<html>
 <head>
  <link href="{% static 'stylesheets/workoutware.css' %}" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <title>
   Manage Goals
  </title>
  <style>
   .goal-form {
    background: var(--bg-card);
    padding: 30px;
    border-radius: 16px;
    margin: 25px 0;
    border: 1px solid var(--border-color);
   }
   .goals-list {
    margin-top: 30px;
   }
   .goal-card {
    background: var(--bg-card);
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 15px;
    border-left: 5px solid var(--primary);
    transition: var(--transition-normal);
   }
   .goal-card:hover {
    transform: translateX(5px);
    box-shadow: var(--shadow-md);
   }
   .goal-card.completed {
    border-left-color: var(--success);
    opacity: 0.7;
   }
   .goal-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
   }
   .btn-complete, .btn-abandon, .btn-delete-goal {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    font-size: 0.85em;
   }
   .btn-complete {
    background: var(--success);
    color: white;
   }
   .btn-abandon {
    background: rgba(253, 203, 110, 0.2);
    color: var(--warning);
    border: 1px solid var(--warning);
   }
   .btn-delete-goal {
    background: rgba(255, 107, 107, 0.2);
    color: var(--danger);
    border: 1px solid var(--danger);
   }
  </style>
 </head>
 <body>
 <div class="container-wrapper">
  <div class="goals-container">
   <h1 class="fade-in">
    <i class="fas fa-bullseye"></i> Fitness Goals
   </h1>
   <div class="nav-links fade-in">
    <a href="{% url 'home' %}">
     <i class="fas fa-arrow-left"></i> Dashboard
    </a>
    <a href="{% url 'progress' %}">
     <i class="fas fa-chart-line"></i> Progress
    </a>
    <a href="{% url 'log_workout' %}">
     <i class="fas fa-dumbbell"></i> Log Workout
    </a>
   </div>
   <div class="goal-form fade-in">
    <h2>
     <i class="fas fa-plus-circle"></i> Set New Goal
    </h2>
    <form method="post">
     {% csrf_token %}
     <label>
      <i class="fas fa-dumbbell"></i> Exercise
     </label>
     <select name="exercise_id" required="">
      <option value="">
       -- Choose Exercise --
      </option>
      {% for ex in exercises %}
      <option value="{{ ex.exercise_id }}">
       {{ ex.name }}
      </option>
      {% endfor %}
     </select>
     <label>
      <i class="fas fa-layer-group"></i> Goal Type
     </label>
     <select name="goal_type" required="">
      <option value="max_weight">
       Max Weight PR
      </option>
      <option value="total_volume">
       Total Volume
      </option>
      <option value="workout_count">
       Number of Workouts
      </option>
     </select>
     <label>
      <i class="fas fa-flag-checkered"></i> Target Value
     </label>
     <input name="target_value" required="" step="0.1" type="number" placeholder="e.g., 225"/>
     <label>
      <i class="fas fa-ruler"></i> Unit
     </label>
     <select name="unit" required="">
      <option value="lbs">Pounds (lbs)</option>
      <option value="kg">Kilograms (kg)</option>
      <option value="reps">Reps</option>
      <option value="workouts">Workouts</option>
     </select>
     <label>
      <i class="far fa-calendar-alt"></i> Target Date (optional)
     </label>
     <input name="target_date" type="date"/>
     <label>
      <i class="fas fa-align-left"></i> Description
     </label>
     <textarea name="goal_description" rows="2" placeholder="e.g., Bench press 225 lbs for 1 rep"></textarea>
     <button type="submit">
      <i class="fas fa-rocket"></i> Create Goal
     </button>
    </form>
   </div>
   <div class="goals-list">
    <h2 class="fade-in">
     <i class="fas fa-fire"></i> Active Goals
    </h2>
    {% for goal in active_goals %}
    <div class="goal-card fade-in">
     <h3 style="margin-top: 0;">
      <i class="fas fa-crosshairs"></i> {{ goal.goal_description|default:goal.goal_type }}
     </h3>
     <p style="color: var(--text-secondary);">
      <i class="fas fa-dumbbell"></i> <strong>{{ goal.exercise_id.name }}</strong> |
      <i class="fas fa-flag"></i> Target: {{ goal.target_value }} {{ goal.unit }}
      {% if goal.target_date %}
      | <i class="far fa-calendar"></i> By {{ goal.target_date|date:"M d, Y" }}
      {% endif %}
     </p>
     {% if goal.current_value %}
     <div class="progress-bar-container">
      {% widthratio goal.current_value goal.target_value 100 as progress %}
      <div class="progress-bar" style="width: {% if progress > 100 %}100{% else %}{{ progress }}{% endif %}%;">
       {{ goal.current_value }} / {{ goal.target_value }} {{ goal.unit }} ({{ progress }}%)
      </div>
     </div>
     {% else %}
     <p style="color: var(--text-muted);">
      <i class="fas fa-hourglass-start"></i> Not started - log workouts to track progress
     </p>
     {% endif %}
     <div class="goal-actions">
      <form action="{% url 'update_goal_status' goal.goal_id %}" method="post" style="display: inline;">
       {% csrf_token %}
       <input type="hidden" name="status" value="completed"/>
       <button class="btn-complete" type="submit">
        <i class="fas fa-check"></i> Complete
       </button>
      </form>
      <form action="{% url 'update_goal_status' goal.goal_id %}" method="post" style="display: inline;">
       {% csrf_token %}
       <input type="hidden" name="status" value="abandoned"/>
       <button class="btn-abandon" type="submit">
        <i class="fas fa-times"></i> Abandon
       </button>
      </form>
      <form action="{% url 'delete_goal' goal.goal_id %}" method="post" style="display: inline;" onsubmit="return confirm('Delete this goal?');">
       {% csrf_token %}
       <button class="btn-delete-goal" type="submit">
        <i class="fas fa-trash"></i>
       </button>
      </form>
     </div>
    </div>
    {% empty %}
    <div class="empty-state fade-in">
     <i class="fas fa-bullseye"></i>
     <p>No active goals. Set one above to stay motivated!</p>
    </div>
    {% endfor %}
    <h2 class="fade-in" style="margin-top: 40px;">
     <i class="fas fa-trophy"></i> Completed Goals
    </h2>
    {% for goal in completed_goals %}
    <div class="goal-card completed fade-in">
     <h3 style="margin-top: 0;">
      <i class="fas fa-check-circle text-success"></i> {{ goal.goal_description|default:goal.goal_type }}
     </h3>
     <p style="color: var(--text-secondary);">
      <i class="fas fa-dumbbell"></i> {{ goal.exercise_id.name }} |
      <i class="fas fa-medal"></i> Achieved: {{ goal.current_value }} {{ goal.unit }}
      {% if goal.completion_date %}
      | <i class="far fa-calendar-check"></i> {{ goal.completion_date|date:"M d, Y" }}
      {% endif %}
     </p>
    </div>
    {% empty %}
    <p class="fade-in" style="color: var(--text-muted);">
     <i class="fas fa-info-circle"></i> No completed goals yet.
    </p>
    {% endfor %}
   </div>
  </div>
  </div>
</body>
</html>
