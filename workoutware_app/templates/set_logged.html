<!--
    Template: Set Logged Confirmation Page

    Purpose:
    --------
    Display a confirmation page after a workout set is logged, including:
      • Smart validation results (normal, outlier, new PR, suspicious low, first-time)
      • Personal Record celebration (animated gold-highlight box)
      • Clear breakdown of the recorded set details
      • Navigation link back to the workout session

    Context Variables Expected:
    ---------------------------
    is_pr : boolean
        Indicates whether this logged set is a new personal record.

    exercise_name : string
        Human-readable name of the exercise (e.g., "Bench Press").

    set : object with attributes:
        • weight (float or None → bodyweight)
        • reps (int)
        • rpe (int, 1–10)
        • set_number (int)

    previous_pr : float or None
        The previous highest recorded weight for this exercise (if any).
        Only used when is_pr is True.

    validation : object containing:
        • flag (string: 'outlier', 'new_pr', 'normal', 'suspicious_low', 'first_time')
        • message (human-readable validation message)

    session_id : int
        Used for navigation back to the workout session.

    Design Notes:
    -------------
    • Five visual validation states exist, each mapped to dedicated color-coded CSS classes.
    • PR section includes animated "pulse" effect.
    • No JavaScript required — this is a fully static feedback page.
    • Safe for production: no state modifications happen here; all logic runs in the backend.

-->
{% load static %}
<!DOCTYPE html>
<html>
 <head>
  <link href="{% static 'stylesheets/workoutware.css' %}" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <title>
   Set Logged
  </title>
  <style>
   .pr-celebration {
    background: linear-gradient(135deg, rgba(0, 184, 148, 0.2) 0%, rgba(0, 206, 201, 0.1) 100%);
    border: 2px solid var(--success);
    border-radius: 16px;
    padding: 40px;
    text-align: center;
    margin: 30px 0;
    position: relative;
    overflow: hidden;
    animation: celebrate 0.5s ease;
   }
   @keyframes celebrate {
    0% { transform: scale(0.9); opacity: 0; }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); opacity: 1; }
   }
   .pr-celebration::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(0, 184, 148, 0.1) 0%, transparent 70%);
    animation: pulse 2s ease-in-out infinite;
   }
   .pr-celebration h2 {
    color: var(--success);
    margin: 0;
    font-size: 2em;
   }
   .validation-box {
    padding: 20px 25px;
    border-radius: 12px;
    margin: 20px 0;
    border-left: 5px solid;
   }
   .flag-new_pr {
    background: rgba(0, 184, 148, 0.1);
    border-color: var(--success);
    color: var(--success);
   }
   .flag-normal {
    background: rgba(116, 185, 255, 0.1);
    border-color: var(--info);
    color: var(--info);
   }
   .flag-outlier, .flag-suspicious_low {
    background: rgba(253, 203, 110, 0.1);
    border-color: var(--warning);
    color: var(--warning);
   }
   .flag-first_time {
    background: rgba(0, 206, 201, 0.1);
    border-color: var(--secondary);
    color: var(--secondary);
   }
   .set-details {
    background: var(--bg-card);
    padding: 25px;
    border-radius: 16px;
    margin: 20px 0;
    border: 1px solid var(--border-color);
   }
   .btn-back {
    display: inline-block;
    background: var(--primary);
    color: white;
    padding: 15px 30px;
    border-radius: 10px;
    text-decoration: none;
    font-weight: 600;
    margin-top: 20px;
    transition: var(--transition-normal);
   }
   .btn-back:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    color: white;
   }
   .demo-note {
    background: var(--bg-elevated);
    padding: 25px;
    border-radius: 12px;
    margin-top: 30px;
    border: 1px solid var(--border-color);
   }
   .demo-note ul {
    padding-left: 20px;
    margin-top: 15px;
   }
   .demo-note li {
    margin-bottom: 10px;
    color: var(--text-secondary);
    list-style: none;
   }
  </style>
 </head>
 <body>
 <div class="container-wrapper">
  <h1 class="fade-in">
   <i class="fas fa-check-circle text-success"></i> Set Logged Successfully!
  </h1>
  {% if is_pr %}
  <div class="pr-celebration fade-in">
   <h2>
    <i class="fas fa-trophy"></i> NEW PERSONAL RECORD! <i class="fas fa-trophy"></i>
   </h2>
   <p style="margin-top: 15px;">
    <strong style="font-size: 1.2em;">
     {{ exercise_name }}
    </strong>
   </p>
   <p style="font-size: 2.5em; margin: 20px 0; color: var(--text-primary);">
    <i class="fas fa-weight-hanging"></i> {{ set.weight }} lbs × {{ set.reps }} reps
   </p>
   {% if previous_pr %}
   <p style="color: var(--text-secondary);">
    Previous PR: {{ previous_pr }} lbs
   </p>
   <p style="color: var(--success); font-weight: bold; font-size: 1.2em;">
    <i class="fas fa-arrow-up"></i> +{{ set.weight|floatformat:1|add:"-"|add:previous_pr|floatformat:1 }} lbs improvement!
   </p>
   {% else %}
   <p style="color: var(--secondary);">
    <i class="fas fa-star"></i> First PR for this exercise!
   </p>
   {% endif %}
  </div>
  {% endif %}
  <div class="validation-box flag-{{ validation.flag }} fade-in">
   <i class="fas fa-shield-check"></i> {{ validation.message }}
  </div>
  <div class="set-details fade-in">
   <h3 style="margin-top: 0;">
    <i class="fas fa-clipboard-list"></i> Set Details
   </h3>
   <p>
    <strong>
     <i class="fas fa-dumbbell"></i> Exercise:
    </strong>
    {{ exercise_name }}
   </p>
   <p>
    <strong>
     <i class="fas fa-weight-hanging"></i> Weight:
    </strong>
    {% if set.weight %}{{ set.weight }} lbs{% else %}Bodyweight{% endif %}
   </p>
   <p>
    <strong>
     <i class="fas fa-repeat"></i> Reps:
    </strong>
    {{ set.reps }}
   </p>
   <p>
    <strong>
     <i class="fas fa-gauge-high"></i> RPE:
    </strong>
    {{ set.rpe }}/10
   </p>
   <p>
    <strong>
     <i class="fas fa-hashtag"></i> Set Number:
    </strong>
    {{ set.set_number }}
   </p>
  </div>
  <a class="btn-back fade-in" href="{% url 'add_exercises_to_session' session_id %}">
   <i class="fas fa-arrow-left"></i> Back to Workout
  </a>
  <div class="demo-note fade-in">
   <p style="margin: 0;">
    <strong>
     <i class="fas fa-lightbulb"></i> Smart Validation &amp; PR Tracking
    </strong>
   </p>
   <p style="color: var(--text-secondary); margin-top: 10px;">
    This system automatically validates workout data and tracks personal records!
   </p>
   <ul>
    <li>
     <i class="fas fa-trophy text-success"></i>
     <strong>
      New PR:
     </strong>
     Celebrates when you beat your previous max
    </li>
    <li>
     <i class="fas fa-exclamation-triangle text-warning"></i>
     <strong>
      Outlier:
     </strong>
     Flags unrealistic jumps (&gt;15% increase)
    </li>
    <li>
     <i class="fas fa-arrow-down text-warning"></i>
     <strong>
      Suspicious Low:
     </strong>
     Catches potential typos (&gt;30% below average)
    </li>
    <li>
     <i class="fas fa-check-circle text-primary"></i>
     <strong>
      Normal:
     </strong>
     Confirms data is within expected range
    </li>
   </ul>
  </div>
  </div>
</body>
</html>
