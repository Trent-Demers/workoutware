<!DOCTYPE html>
<html>
<head>
    <title>Manage Workout Session</title>
    <link rel="stylesheet" type="text/css" href="/static/stylesheets/workoutware.css">
    <style>
        body { background: #f4f6f9; font-family: Arial; }
        .container { max-width: 900px; margin: 30px auto; background: white; padding: 20px; border-radius: 10px; }
        h1 { text-align: center; margin-bottom: 20px; }
        .exercise-block { margin-bottom: 20px; padding: 15px; background: #fafafa; border-radius: 8px; }
        .sets-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .sets-table td, .sets-table th { border: 1px solid #ddd; padding: 8px; text-align: center; }
        .set-form { margin-top: 10px; }
    </style>
</head>

<body>
<div class="container">

    <h1>
        Add Exercise to Workout Session
        {% if session.session_name %} ({{ session.session_name }}){% endif %}
    </h1>

    <!-- ADD EXERCISE FORM -->
    <form method="POST" action="{% url 'add_exercise_to_session' session.session_id %}">
        {% csrf_token %}
        <label>Select Exercise:</label>
        <select name="exercise_id" required>
            {% for ex in exercises %}
                <option value="{{ ex.exercise_id }}">{{ ex.name }}</option>
            {% endfor %}
        </select>

        <label>Target Sets:</label>
        <input type="number" name="target_sets" value="3">

        <label>Target Reps:</label>
        <input type="number" name="target_reps" value="10">

        <button type="submit">Add Exercise</button>
    </form>

    <hr>

    <h2>Exercises in This Workout Session</h2>

    {% if session_data %}
        {% for item in session_data %}
        <div class="exercise-block">

            <h3>{{ forloop.counter }}. {{ item.session_exercise.exercise_id.name }}</h3>
            <p>
                Target: {{ item.session_exercise.target_sets }} sets Ã— {{ item.session_exercise.target_reps }} reps
            </p>

            {% if not session.is_template %}
            <!-- LOG NEXT SET -->
            <form method="POST" action="{% url 'log_set' item.session_exercise.session_exercise_id %}" class="set-form">
                {% csrf_token %}
                <label>Weight (lbs):</label>
                <input type="number" step="0.1" name="weight">

                <label>Reps:</label>
                <input type="number" name="reps">

                <label>RPE:</label>
                <input type="number" name="rpe" value="7">

                <input type="hidden" name="set_number" value="{{ item.sets|length|add:1 }}">
                <button type="submit">Log Set</button>
            </form>
            {% endif %}

            <h4>
                {% if session.is_template %}Planned Sets:{% else %}Completed Sets:{% endif %}
            </h4>

            {% if item.sets %}
            <table class="sets-table">
                <tr>
                    <th>Set #</th>
                    <th>Weight</th>
                    <th>Reps</th>
                    <th>RPE</th>
                </tr>
                {% for set in item.sets %}
                <tr>
                    <td>{{ set.set_number }}</td>
                    <td>{% if set.weight %}{{ set.weight }}{% else %}Bodyweight{% endif %}</td>
                    <td>{{ set.reps }}</td>
                    <td>{{ set.rpe }}</td>
                </tr>
                {% endfor %}
            </table>
            {% else %}
                <p>No sets logged yet.</p>
            {% endif %}

        </div>
        {% endfor %}
    {% else %}
        <p>No exercises added yet.</p>
    {% endif %}

</div>
</body>
</html>

