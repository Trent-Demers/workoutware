<!--
    Template: Community Leaderboard

    Purpose:
    - Display leaderboard-style aggregated fitness statistics for all users.
    - Preserve user privacy by showing only anonymous identifiers (no names).
    - Provide three major components:
        1. Navigation buttons for quick access to dashboard, progress, and goals.
        2. Top Lifts:
            • Shows highest recorded weights for each exercise across all users.
            • Sorted in descending order of top_weight.
        3. Most Active This Month:
            • Shows users with the highest workout counts in the current month.
            • Uses anonymous user_id to maintain privacy.

    Context variables expected from Django view:
    - top_lifts:
        • Each object contains: exercise_id__name, top_weight
    - most_active:
        • Each object contains: user_id, workout_count
    - These values are pre-aggregated in the backend using annotate(), Max(), Count(), etc.

    Privacy Notice:
    - Template intentionally does not display personal data (name, email).
    - Only anonymous User ID values appear.

    Styling Notes:
    - rank-badge uses color-coded circles for ranks #1, #2, #3, and others.
    - leaderboard-section visually separates the two ranking categories.
-->
{% load static %}
<!DOCTYPE html>
<html>
 <head>
  <link href="{% static 'stylesheets/workoutware.css' %}" rel="stylesheet" type="text/css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <title>
   Leaderboard
  </title>
  <style>
   .info-box {
    background: rgba(116, 185, 255, 0.1);
    border-left: 5px solid var(--info);
    padding: 20px;
    border-radius: 8px;
    margin: 20px 0;
   }
   .leaderboard-section {
    margin: 30px 0;
   }
  </style>
 </head>
 <body>
 <div class="container-wrapper">
  <div class="leaderboard-container">
   <h1 class="fade-in">
    <i class="fas fa-trophy"></i> Community Leaderboard
   </h1>
   <div class="nav-links fade-in">
    <a href="{% url 'home' %}">
     <i class="fas fa-arrow-left"></i> Dashboard
    </a>
    <a href="{% url 'progress' %}">
     <i class="fas fa-chart-line"></i> My Progress
    </a>
    <a href="{% url 'manage_goals' %}">
     <i class="fas fa-bullseye"></i> Goals
    </a>
   </div>
   <div class="info-box fade-in">
    <p style="margin: 0; color: var(--info);">
     <strong>
      <i class="fas fa-shield-alt"></i> Privacy Notice:
     </strong>
     All leaderboard data is anonymous. No personal information is displayed to protect user privacy.
    </p>
   </div>
   <div class="leaderboard-section fade-in">
    <h2>
     <i class="fas fa-dumbbell"></i> Top Lifts by Exercise
    </h2>
    <p style="color: var(--text-muted); margin-bottom: 20px;">
     Highest recorded weights across all users
    </p>
    {% if top_lifts %}
    <table class="leaderboard-table">
     <thead>
      <tr>
       <th style="width: 80px;">
        <i class="fas fa-medal"></i> Rank
       </th>
       <th>
        <i class="fas fa-dumbbell"></i> Exercise
       </th>
       <th>
        <i class="fas fa-weight-hanging"></i> Max Weight
       </th>
       <th>
        <i class="fas fa-user-secret"></i> Lifter
       </th>
       <th>
        <i class="far fa-calendar"></i> Date
       </th>
      </tr>
     </thead>
     <tbody>
      {% for lift in top_lifts %}
      <tr>
       <td>
        {% if forloop.counter == 1 %}
        <i class="fas fa-crown" style="color: gold;"></i>
        {% elif forloop.counter == 2 %}
        <i class="fas fa-medal" style="color: silver;"></i>
        {% elif forloop.counter == 3 %}
        <i class="fas fa-medal" style="color: #cd7f32;"></i>
        {% else %}
        #{{ forloop.counter }}
        {% endif %}
       </td>
       <td>
        <strong>{{ lift.exercise_name }}</strong>
       </td>
       <td>
        {{ lift.max_weight }} lbs
       </td>
       <td>
        Anonymous #{{ lift.user_id }}
       </td>
       <td>
        {{ lift.date|date:"M d, Y" }}
       </td>
      </tr>
      {% endfor %}
     </tbody>
    </table>
    {% else %}
    <div class="empty-state">
     <i class="fas fa-trophy"></i>
     <p>No lift data yet. Be the first to set a record!</p>
    </div>
    {% endif %}
   </div>
   <div class="leaderboard-section fade-in">
    <h2>
     <i class="fas fa-fire"></i> Most Active Users
    </h2>
    <p style="color: var(--text-muted); margin-bottom: 20px;">
     Top users by workout count this month
    </p>
    {% if most_active %}
    <table class="leaderboard-table">
     <thead>
      <tr>
       <th style="width: 80px;">
        <i class="fas fa-medal"></i> Rank
       </th>
       <th>
        <i class="fas fa-user-secret"></i> User
       </th>
       <th>
        <i class="fas fa-clipboard-list"></i> Workouts
       </th>
       <th>
        <i class="fas fa-fire-flame-curved"></i> Streak
       </th>
      </tr>
     </thead>
     <tbody>
      {% for user in most_active %}
      <tr>
       <td>
        {% if forloop.counter == 1 %}
        <i class="fas fa-crown" style="color: gold;"></i>
        {% elif forloop.counter == 2 %}
        <i class="fas fa-medal" style="color: silver;"></i>
        {% elif forloop.counter == 3 %}
        <i class="fas fa-medal" style="color: #cd7f32;"></i>
        {% else %}
        #{{ forloop.counter }}
        {% endif %}
       </td>
       <td>
        Anonymous #{{ user.user_id }}
       </td>
       <td>
        {{ user.workout_count }}
       </td>
       <td>
        {{ user.streak_days }} days
       </td>
      </tr>
      {% endfor %}
     </tbody>
    </table>
    {% else %}
    <div class="empty-state">
     <i class="fas fa-users"></i>
     <p>No activity data yet.</p>
    </div>
    {% endif %}
   </div>
  </div>
  </div>
</body>
</html>
